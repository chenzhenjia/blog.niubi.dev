<!doctype html><html lang=zh-cn><head><meta name=generator content="Hugo 0.103.1"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>陈</title><meta name=Description content="陈asdasdasd"><meta property="og:title" content="陈"><meta property="og:description" content="陈asdasdasd"><meta property="og:type" content="website"><meta property="og:url" content="https://blog.niubi.dev/"><meta property="og:site_name" content="陈"><meta name=twitter:card content="summary"><meta name=twitter:title content="陈"><meta name=twitter:description content="陈asdasdasd"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.niubi.dev/><link rel=alternate href=/index.xml type=application/rss+xml title=陈><link rel=feed href=/index.xml type=application/rss+xml title=陈><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","url":"https:\/\/blog.niubi.dev\/","inLanguage":"zh-cn","author":{"@type":"Person","name":"陈"},"description":"陈asdasdasd","name":"陈"}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=陈>陈</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=陈>陈</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class="page home" data-home=posts><div class=home-profile><div class=links></div></div><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/springboot%E9%85%8D%E7%BD%AEvuejs%E6%88%96%E8%80%85react%E7%9A%84history%E8%B7%AF%E7%94%B1/>SpringBoot配置VueJs或者React的history路由</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>陈</a></span>&nbsp;<span class=post-publish>published on <time datetime=2019-10-24>2019-10-24</time></span></div><div class=content>一般在配置前端的文件夹的时候都会指定一个路径，如果你想使用根路径我这种方法不支持根路径，请使用另外一种支持根路径的配置方法。
配置 比如把前端放在 h5 路径下面
把前端打包的文件放在resource/META-INF/h5 目录
修改Spring Boot WebMvc的配置
@Configuration public class WebMvcConfiguration implements WebMvcConfigurer { @Override public void addResourceHandlers(ResourceHandlerRegistry registry) { registry.addResourceHandler("/h5/**") .addResourceLocations("classpath:/META-INF/h5/"); } @Override public void addViewControllers(ViewControllerRegistry registry) { // 配置如果用户访问的是根目录直接重定向掉h5页面 registry.addRedirectViewController("/", "h5"); // 配置用户如果访问h5路径但是没有带index.html 转发到 /h5/index.html 路径 registry.addViewController("/h5") .setViewName("forward:/h5/index.html"); registry.addViewController("/h5/") .setViewName("forward:/h5/index.html"); // 一下是为了给前端 history路由的一些配置 registry.addViewController("/h5/{spring:\\w+}") .setViewName("forward:/h5/index.html"); registry.addViewController("/h5/**/{spring:\\w+}") .setViewName("forward/h5/index.html"); registry.addViewController("/h5/{spring:\\w+}/**{spring:?!(\\.js|\\.css)$}") .setViewName("forward:/h5/index.html"); } }</div><div class=post-footer><a href=/posts/springboot%E9%85%8D%E7%BD%AEvuejs%E6%88%96%E8%80%85react%E7%9A%84history%E8%B7%AF%E7%94%B1/>Read More</a></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/%E5%9C%A8centos%E4%B8%8A%E6%90%AD%E5%BB%BAk3s%E9%9B%86%E7%BE%A4/>在 centos 上搭建k3s 集群</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>陈</a></span>&nbsp;<span class=post-publish>published on <time datetime=2019-08-24>2019-08-24</time></span></div><div class=content>介绍 k3s k3s 是Rancher Labs（以下简称Rancher）宣布推出轻量级Kubernetes发行版K3s（已开源），这款产品专为在资源有限的环境中运行Kubernetes的研发和运维人员设计。Rancher此次发布的K3s项目，将满足在边缘计算环境中运行在x86、ARM64和ARMv7处理器上的小型、易于管理的Kubernetes集群日益增长的需求。
开始安装 安装 docker 官方文档 这里推荐使用官方的脚本一键安装
curl -fsSL https://get.docker.com -o get-docker.sh sudo sh get-docker.sh 如果你想使用 k3s 默认的 contanerd 容器可以跳过，但是由于我对 contanerd 不熟悉所以我在这里使用的是 docker
安装 k3s server
安装 k3s server 有几种方式，由于 k3s 的执行文件是是放在 github上的，但是在中国由于网速不好可能会导致下载不下来，所以可以先使用其它工具下载可执行文件然后上传到服务器上的 /usr/local/bin 目录下，然后执行 chmod 0755 /usr/local/bin/k3s 命令给与执行权限
直接下载安装:
curl -sfL https://get.k3s.io | INSTALL_K3S_EXEC="server --no-deploy traefik --docker" sh -s - 自己下载安装:
curl -sfL https://get.k3s.io | INSTALL_K3S_EXEC="server --no-deploy traefik --docker" INSTALL_K3S_BIN_DIR="/usr/local/bin" INSTALL_K3S_SKIP_DOWNLOAD=true sh -s - 参数说明: INSTALL_K3S_EXEC k3s 启动的参数 &ndash;no-deploy traefik 是说不需要部署 traefik ingress，_&ndash;docker_是说使用 docker 容器 INSTALL_K3S_BIN _DIRk3s 可执行文件的目录 INSTALL_K3S_SKIP _DOWNLOAD true 跳过下载k3s 可执行文件</div><div class=post-footer><a href=/posts/%E5%9C%A8centos%E4%B8%8A%E6%90%AD%E5%BB%BAk3s%E9%9B%86%E7%BE%A4/>Read More</a></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/golang%E5%9C%A8windows%E4%B8%8A%E5%90%8C%E6%97%B6%E7%BC%96%E8%AF%9164%E4%BD%8D%E5%92%8C32%E4%BD%8D%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F/>Golang在Windows上同时编译64位和32位可执行程序</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>陈</a></span>&nbsp;<span class=post-publish>published on <time datetime=2018-11-02>2018-11-02</time></span></div><div class=content>Golang 在 Windows 上同时编译64位和32位可执行程序 需要在windows上同时编译需要64位的系统，32位只能编译32位的可执行程序。
编译32位 GOOS=windows GOARCH=386 go build main.go 编译64位 GOOS=windows GOARCH=amd64 go build main.go 遇到的问题 由于在项目中用到了sqlite所以在编译的时候报 exec: &ldquo;gcc&rdquo;: executable file not found in %PATH%，这是因为在windows上缺少 gcc,所以在windows 上需要安装 MinGW。
下载 MinGW 进入下载页面
下载 MinGW64，注意请选择 _x86_64-posix-seh MinGW64 8.1.0 下载地址
下载 MinGW32 MinGW32 8.1.0 下载地址
解压 MinGW32和MinGW64 注意需要解压到不同地方，可以平级但是千万不要在同一个目录
编译 在编译之前先设置 MinGW 的环境变量，因为是一次性的所以直接用命令行来设置
64位编译 请注意_C:MinGW64bin_ 应该改为你的64位MinGW路径 set PATH=C:\MinGW64\bin;%PATH% GOOS=windows GOARCH=386 go build main.go * 32位编译 请注意_C:MinGW32bin_ 应该改为你的32位MinGW路径 ```bash set PATH=C:\MinGW32\bin;%PATH% GOOS=windows GOARCH=amd64 go build main.</div><div class=post-footer><a href=/posts/golang%E5%9C%A8windows%E4%B8%8A%E5%90%8C%E6%97%B6%E7%BC%96%E8%AF%9164%E4%BD%8D%E5%92%8C32%E4%BD%8D%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F/>Read More</a></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/spring-mvc-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E4%B8%8B%E8%BD%BD/>Spring MVC 自定义静态资源下载</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>陈</a></span>&nbsp;<span class=post-publish>published on <time datetime=2018-09-04>2018-09-04</time></span></div><div class=content>在 Spring MVC 中上传文件后把文件保存在本地，但是数据库保存了一份路径，所有需要实现下载文件，网上的教程一般都是自己写一个Controller 去下载，但是我这里直接使用Spring MVC的 ResourceHttpRequestHandler 实现动态下载静态资源，只需一点点代码然后加一段配置就可以实现下载附件功能。
第一步 自定义一个Handler，并重写 ResourceHttpRequestHandler 的 processPath 方法。
@Slf4j public class CustomResourceHttpRequestHandler extends ResourceHttpRequestHandler { private final UploadRepository uploadRepository; public CustomResourceHttpRequestHandler(UploadRepository uploadRepository) { this.uploadRepository = uploadRepository; } // 重写该方法实现动态获取文件路径，而不是直接获取本地文件的路径 @Override protected String processPath(String path) { Optional&lt;Upload> uploadOption = uploadRepository.findById(path); return uploadOption.map(Upload::getPath) .orElseGet(() -> { log.warn("文件获取path不存在。path={}", path); return null; }); } } 第二部配置 在 Spring Boot 中添加一下配置，注意LocationValues 的路径，必须以 / 结尾，访问本地文件必须有 file: ，不然会访问不到，报404
@Bean public ResourceHttpRequestHandler customResourceHttpRequestHandler(UploadRepository uploadRepository) { ResourceHttpRequestHandler requestHandler = new CustomResourceHttpRequestHandler(uploadRepository); requestHandler.</div><div class=post-footer><a href=/posts/spring-mvc-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E4%B8%8B%E8%BD%BD/>Read More</a></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/%E4%BC%98%E9%9B%85%E5%BC%80%E5%90%AF%E5%92%8C%E5%85%B3%E9%97%ADspringcloud%E9%A1%B9%E7%9B%AE/>优雅开启和关闭Spring Cloud项目</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>陈</a></span>&nbsp;<span class=post-publish>published on <time datetime=2018-08-18>2018-08-18</time></span></div><div class=content>第一种方式,使用脚本(不推荐) 使用命令行开启和关闭，直接 kill 掉Spring boot 进程，这样会导致Spring Cloud 项目不会去 注册中心把自己销毁掉，明明项目已经关闭，但是注册中心还是显示在线，而且这样还会有一个弊端，如果需 要监听Spring Boot 项目的生命周期钩子，比如项目启动和关闭，也会监听不到。 /home/dev/app.sh
#!/bin/bash APP_NAME=$2 #使用说明，用来提示输入参数 usage() { echo "Usage: sh 执行脚本.sh [start|stop|restart|status]" exit 1 } #检查程序是否在运行 is_exist(){ count=`ps -ef |grep java|grep $APP_NAME|grep -v grep|wc -l` #如果不存在返回1，存在返回0 if [ $count == 0 ]; then return 1 else return 0 fi } #启动方法 start(){ is_exist if [ $? -eq "0" ]; then echo "${APP_NAME} is already running. pid=${pid} ." else SHELL_FOLDER=$(cd "$(dirname "$0")";pwd) JAR_PATH="$SHELL_FOLDER/.</div><div class=post-footer><a href=/posts/%E4%BC%98%E9%9B%85%E5%BC%80%E5%90%AF%E5%92%8C%E5%85%B3%E9%97%ADspringcloud%E9%A1%B9%E7%9B%AE/>Read More</a></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/expect%E7%9A%84%E7%94%A8%E6%B3%95/>expect 的用法</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>陈</a></span>&nbsp;<span class=post-publish>published on <time datetime=2018-08-17>2018-08-17</time></span></div><div class=content>!/usr/bin/expect 告诉操作系统脚本里的代码使用那一个shell来执行。
注意：这段代码必须在第一行。
set timeout 设置超时时间，计时单位是：秒 ，timeout -1 为永不超时。
spawn spawn是进入expect环境后才可以执行的expect内部命令，如果没有装expect或者直接在默认的SHELL下执行是找不到spawn命令的。所以不要用 which spawn 之类的命令去找spawn命令。
它主要的功能是给ssh运行进程加个壳，用来传递交互指令。
expect &ldquo;str&rdquo; 这个命令的意思是判断上次输出结果里是否包含“str”的字符串，如果有则立即返回，否则就等待一段时间后返回，这里等待时长就是 set timeout send "" 这里就是执行交互动作，
命令字符串结尾别忘记加上“\r”，如果出现异常等待的状态可以核查一下。
interact 执行完成后保持交互状态，把控制权交给控制台，这个时候就可以手工操作了。如果没有这一句登录完成后会退出，而不是留在远程终端上。如果你只是登录过去执行
$argv 参数数组 expect脚本可以接受从bash传递过来的参数.可以使用[lindex $argv n]获得，n从0开始，分别表示第一个,第二个,第三个&mldr;.参数
示例 expect 调用 ssh 密码登陆 #!/usr/bin/expect set timeout 5 set password "1234" spawn ssh root@127.1.1 expect { "yes/no" { send "yes\r"; exp_continue } "Password:" { send "$password\r" } } interact</div><div class=post-footer><a href=/posts/expect%E7%9A%84%E7%94%A8%E6%B3%95/>Read More</a></div></article><ul class=pagination><li class="page-item active"><span class=page-link><a href=/>1</a></span></li><li class=page-item><span class=page-link><a href=/page/2/>2</a></span></li><li class=page-item><span class=page-link><a href=/page/3/>3</a></span></li><li class=page-item><span class=page-link><a href=/page/4/>4</a></span></li></ul></div></div></main><footer class=footer><div class=footer-container><div class=footer-line><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5524310624522502" crossorigin=anonymous></script></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>陈</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>