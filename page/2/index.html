<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2592788502290192",
          enable_page_level_ads: true
     });
</script>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="alternate" href="/atom.xml" title="陈先森" type="application/atom+xml">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    sidebarPadding: 40
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="陈先森">
<meta property="og:url" content="https:&#x2F;&#x2F;blog.niubi.dev&#x2F;page&#x2F;2&#x2F;index.html">
<meta property="og:site_name" content="陈先森">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://blog.niubi.dev/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>陈先森</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-107997548-2"></script>
    <script>
      var host = window.location.hostname;
      if (host !== "localhost" || !false) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-107997548-2');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">陈先森</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.niubi.dev/golang-zai-windows-shang-tong-shi-bian-yi-64wei-he-32wei-ke-zhi-xing-cheng-xu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="陈先森">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="陈先森">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/golang-zai-windows-shang-tong-shi-bian-yi-64wei-he-32wei-ke-zhi-xing-cheng-xu/" class="post-title-link" itemprop="url">Golang 在 Windows 上同时编译64位和32位可执行程序</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2018-11-02 18:38:39 / 修改时间：10:41:53" itemprop="dateCreated datePublished" datetime="2018-11-02T18:38:39+00:00">2018-11-02</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Golang-在-Windows-上同时编译64位和32位可执行程序"><a href="#Golang-在-Windows-上同时编译64位和32位可执行程序" class="headerlink" title="Golang 在 Windows 上同时编译64位和32位可执行程序"></a>Golang 在 Windows 上同时编译64位和32位可执行程序</h2><p><em>需要在windows上同时编译需要64位的系统，32位只能编译32位的可执行程序。</em></p>
<ul>
<li><p>编译32位</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GOOS=windows GOARCH=386 go build main.go</span><br></pre></td></tr></table></figure></li>
<li><p>编译64位</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GOOS=windows GOARCH=amd64 go build main.go</span><br></pre></td></tr></table></figure>
<h3 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><p>由于在项目中用到了<strong>sqlite</strong>所以在编译的时候报 <strong>exec: “gcc”: executable file not found in %PATH%</strong>，这是因为在windows上缺少 <em>gcc</em>,所以在windows 上需要安装 _MinGW_。</p>
</li>
<li><p>下载 MinGW<br>  <a href="https://sourceforge.net/projects/mingw-w64/files/Toolchains%20targetting%20Win64/Personal%20Builds/%20" target="_blank" rel="noopener">进入下载页面</a></p>
<ul>
<li><p>下载 MinGW64，注意请选择 _x86_64-posix-seh<br>  <a href="https://sourceforge.net/projects/mingw-w64/files/Toolchains%20targetting%20Win64/Personal%20Builds/mingw-builds/8.1.0/threads-posix/seh/x86_64-8.1.0-release-posix-seh-rt_v6-rev0.7z" target="_blank" rel="noopener">MinGW64 8.1.0 下载地址</a></p>
</li>
<li><p>下载 MinGW32<br>  <a href="https://sourceforge.net/projects/mingw-w64/files/Toolchains%20targetting%20Win64/Personal%20Builds/mingw-builds/8.1.0/threads-win32/seh/x86_64-8.1.0-release-win32-seh-rt_v6-rev0.7z" target="_blank" rel="noopener">MinGW32 8.1.0 下载地址</a></p>
</li>
</ul>
</li>
<li><p>解压 MinGW32和MinGW64<br>  <em>注意需要解压到不同地方，可以平级但是千万不要在同一个目录</em></p>
</li>
<li><p>编译<br>  在编译之前先设置 MinGW 的环境变量，因为是一次性的所以直接用命令行来设置</p>
<ul>
<li>64位编译<br>  请注意<em>C:MinGW64bin</em> 应该改为你的64位MinGW路径  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> PATH=C:\MinGW64\bin;%PATH%</span><br><span class="line">GOOS=windows GOARCH=386 go build main.go</span><br></pre></td></tr></table></figure>
<ul>
<li>32位编译<br>请注意<em>C:MinGW32bin</em> 应该改为你的32位MinGW路径<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> PATH=C:\MinGW32\bin;%PATH%</span><br><span class="line">GOOS=windows GOARCH=amd64 go build main.go</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="大公告成"><a href="#大公告成" class="headerlink" title="大公告成"></a>大公告成</h1>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.niubi.dev/spring-mvc-zi-ding-yi-jing-tai-zi-yuan-xia-zai/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="陈先森">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="陈先森">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/spring-mvc-zi-ding-yi-jing-tai-zi-yuan-xia-zai/" class="post-title-link" itemprop="url">Spring MVC 自定义静态资源下载</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-09-04 14:18:53" itemprop="dateCreated datePublished" datetime="2018-09-04T14:18:53+00:00">2018-09-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-09-07 15:12:35" itemprop="dateModified" datetime="2018-09-07T15:12:35+00:00">2018-09-07</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在 Spring MVC 中上传文件后把文件保存在本地，但是数据库保存了一份路径，所有需要实现下载文件，网上的教程一般都是自己写一个Controller 去下载，但是我这里直接使用Spring MVC的 <code>ResourceHttpRequestHandler</code> 实现动态下载静态资源，只需一点点代码然后加一段配置就可以实现下载附件功能。</p>
<h2 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h2><p>自定义一个Handler，并重写 <code>ResourceHttpRequestHandler</code> 的 <code>processPath</code> 方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Slf4j</span><br><span class="line">public class CustomResourceHttpRequestHandler extends ResourceHttpRequestHandler &#123;</span><br><span class="line">    private final UploadRepository uploadRepository;</span><br><span class="line"></span><br><span class="line">    public CustomResourceHttpRequestHandler(UploadRepository uploadRepository) &#123;</span><br><span class="line">        this.uploadRepository = uploadRepository;</span><br><span class="line">    &#125;</span><br><span class="line">    // 重写该方法实现动态获取文件路径，而不是直接获取本地文件的路径</span><br><span class="line">    @Override</span><br><span class="line">    protected String processPath(String path) &#123;</span><br><span class="line">        Optional&lt;Upload&gt; uploadOption = uploadRepository.findById(path);</span><br><span class="line">        return uploadOption.map(Upload::getPath)</span><br><span class="line">                .orElseGet(() -&gt; &#123;</span><br><span class="line">                    log.warn(&quot;文件获取path不存在。path=&#123;&#125;&quot;, path);</span><br><span class="line">                    return  null;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第二部配置"><a href="#第二部配置" class="headerlink" title="第二部配置"></a>第二部配置</h2><p>在 Spring Boot 中添加一下配置，注意LocationValues 的路径，必须以 <code>/</code> 结尾，访问本地文件必须有 <code>file:</code> ，不然会访问不到，报404</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public ResourceHttpRequestHandler customResourceHttpRequestHandler(UploadRepository uploadRepository) &#123;</span><br><span class="line">    ResourceHttpRequestHandler requestHandler = new </span><br><span class="line">               CustomResourceHttpRequestHandler(uploadRepository); </span><br><span class="line">    requestHandler.setLocationValues(Collections</span><br><span class="line">                      .singletonList(&quot;file:/D:/upload/&quot;));</span><br><span class="line">    // 资源缓存配置，缓存90天</span><br><span class="line">    requestHandler.setCacheControl(CacheControl.maxAge(90, TimeUnit.DAYS));</span><br><span class="line">    return requestHandler;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">public SimpleUrlHandlerMapping sampleServletMapping() &#123;</span><br><span class="line">    SimpleUrlHandlerMapping mapping = new SimpleUrlHandlerMapping();</span><br><span class="line">    mapping.setOrder(Integer.MAX_VALUE - 2);</span><br><span class="line">    Properties urlProperties = new Properties();</span><br><span class="line">    urlProperties.put(&quot;/files/*&quot;, &quot;customResourceHttpRequestHandler&quot;);</span><br><span class="line">    mapping.setMappings(urlProperties);</span><br><span class="line">    return mapping;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>在地址栏输入地址,最后一位是数据库中 附件的id</p>
<p><a href="http://localhost:8080/files/{id}" target="_blank" rel="noopener">http://localhost:8080/files/{id}</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.niubi.dev/you-ya-kai-qi-he-guan-bi-spring-cloudxiang-mu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="陈先森">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="陈先森">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/you-ya-kai-qi-he-guan-bi-spring-cloudxiang-mu/" class="post-title-link" itemprop="url">优雅开启和关闭Spring Cloud项目</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-18 12:59:08" itemprop="dateCreated datePublished" datetime="2018-08-18T12:59:08+00:00">2018-08-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-08-29 02:38:08" itemprop="dateModified" datetime="2018-08-29T02:38:08+00:00">2018-08-29</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="第一种方式-使用脚本-不推荐"><a href="#第一种方式-使用脚本-不推荐" class="headerlink" title="第一种方式,使用脚本(不推荐)"></a>第一种方式,使用脚本(不推荐)</h1><p>使用命令行开启和关闭，直接 kill 掉Spring boot 进程，这样会导致Spring Cloud 项目不会去 注册中心把自己销毁掉，明明项目已经关闭，但是注册中心还是显示在线，而且这样还会有一个弊端，如果需<br>要监听Spring Boot 项目的生命周期钩子，比如项目启动和关闭，也会监听不到。<br><code>/home/dev/app.sh</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">APP_NAME=$2</span><br><span class="line">#使用说明，用来提示输入参数</span><br><span class="line">usage() &#123;</span><br><span class="line">    echo &quot;Usage: sh 执行脚本.sh [start|stop|restart|status]&quot;</span><br><span class="line">    exit 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#检查程序是否在运行</span><br><span class="line">is_exist()&#123;</span><br><span class="line">  count=`ps -ef |grep java|grep $APP_NAME|grep -v grep|wc -l`</span><br><span class="line">  #如果不存在返回1，存在返回0     </span><br><span class="line">  if [ $count == 0 ]; then</span><br><span class="line">   return 1</span><br><span class="line">  else</span><br><span class="line">    return 0</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#启动方法</span><br><span class="line">start()&#123;</span><br><span class="line">  is_exist</span><br><span class="line">  if [ $? -eq &quot;0&quot; ]; then</span><br><span class="line">    echo &quot;$&#123;APP_NAME&#125; is already running. pid=$&#123;pid&#125; .&quot;</span><br><span class="line">  else</span><br><span class="line">    SHELL_FOLDER=$(cd &quot;$(dirname &quot;$0&quot;)&quot;;pwd)</span><br><span class="line">    JAR_PATH=&quot;$SHELL_FOLDER/../applications/$APP_NAME.jar&quot;</span><br><span class="line">    CONF_PATH=&quot;$SHELL_FOLDER/../conf/logback-spring.xml&quot;</span><br><span class="line">    nohup java -jar $JAR_PATH --logging.config=$CONF_PATH --spring.profiles.active=test &gt; /dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">   # java -jar $JAR_PATH --logging.config=$CONF_PATH</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#停止方法</span><br><span class="line">stop()&#123;</span><br><span class="line">  is_exist</span><br><span class="line">  if [ $? -eq &quot;0&quot; ]; then</span><br><span class="line">    pid=`ps -ef |grep java|grep $APP_NAME|grep -v grep|awk &apos;&#123;print $2&#125;&apos;`</span><br><span class="line">    echo &quot;Stop $APP_NAME, pid $pid&quot;    </span><br><span class="line">    kill -9 $pid</span><br><span class="line">  else</span><br><span class="line">    echo &quot;$&#123;APP_NAME&#125; is not running&quot;</span><br><span class="line">  fi  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#输出运行状态</span><br><span class="line">status()&#123;</span><br><span class="line">  is_exist</span><br><span class="line">  if [ $? -eq &quot;0&quot; ]; then</span><br><span class="line">    echo &quot;$&#123;APP_NAME&#125; is running. Pid is $&#123;pid&#125;&quot;</span><br><span class="line">  else</span><br><span class="line">    echo &quot;$&#123;APP_NAME&#125; is NOT running.&quot;</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#重启</span><br><span class="line">restart()&#123;</span><br><span class="line">  stop</span><br><span class="line">  start</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#根据输入参数，选择执行对应方法，不输入则执行使用说明</span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">  &quot;start&quot;)</span><br><span class="line">    start</span><br><span class="line">    ;;</span><br><span class="line">  &quot;stop&quot;)</span><br><span class="line">    stop</span><br><span class="line">    ;;</span><br><span class="line">  &quot;status&quot;)</span><br><span class="line">    status</span><br><span class="line">    ;;</span><br><span class="line">  &quot;restart&quot;)</span><br><span class="line">    restart</span><br><span class="line">    ;;</span><br><span class="line">  *)</span><br><span class="line">    usage</span><br><span class="line">    ;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>
<p><em>使用:</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">开启</span><br><span class="line">./app start myapp.jar</span><br><span class="line">关闭</span><br><span class="line">./app stop myapp.jar</span><br><span class="line"># 重启</span><br><span class="line">./app.sh restart myapp.jar</span><br></pre></td></tr></table></figure>
<h1 id="第二种方式-打包可执行jar-推荐"><a href="#第二种方式-打包可执行jar-推荐" class="headerlink" title="第二种方式,打包可执行jar(推荐)"></a>第二种方式,打包可执行jar(推荐)</h1><p>打包可执行的jar可以支持 systemctl 启动，也可以支持脚本启动，并且执行关闭后会冲注册中心销毁掉服务，并且会在启动和关闭会调用Spring Boot 的生命周期事件。</p>
<ol>
<li><p>编译工具配置</p>
<ul>
<li>Maven <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executable</span>&gt;</span>true<span class="tag">&lt;/<span class="name">executable</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Gradle <figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bootJar &#123;</span><br><span class="line">    launchScript()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
修改之后然后重新打包     </li>
</ul>
</li>
<li><p>systemd 配置</p>
<ul>
<li>添加 systemd 的配置文件<br><code>/etc/systemd/system/my-app.service</code><br><em>注意：多个服务请创建多个文件</em><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=my-app.service</span><br><span class="line">After=syslog.target</span><br><span class="line">[Service]</span><br><span class="line">User=dev</span><br><span class="line">ExecStart=my-app.jar --logging.config=logback-spring.xml --spring.profiles.active=prod</span><br><span class="line">SuccessExitStatus=143</span><br><span class="line">TimeoutStopSec=10</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=5</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></li>
<li>启用 服务<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable my-app.service</span><br><span class="line">## 开启服务</span><br><span class="line">systemctl start my-app</span><br><span class="line">## 关闭服务</span><br><span class="line">systemctl stop my-app</span><br><span class="line">## 查看服务状态</span><br><span class="line">systemctl status my-app</span><br><span class="line">## 重启服务状态</span><br><span class="line">systemctl restart my-app</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>指定应用重新的内存等等<br>在 my-app.jar 的同一个文件夹创建一个 my-app.conf 文件。<br><em>注意:配置文件必须和jar包的文件名一直才生效。</em><br>其它配置请看<a href="https://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/html/deployment-install.html#deployment-script-customization-when-it-runs" target="_blank" rel="noopener" _blank>更多配置</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 指定内存为256</span><br><span class="line">JAVA_OPTS=&quot;-Xmx256m -Xms256m&quot;</span><br><span class="line"># 指定操作模式，通常是 auto，但是我们这里使用 service</span><br><span class="line">MODE=service</span><br><span class="line"># 指定 pid文件路径</span><br><span class="line">PID_FOLDER=./pid</span><br><span class="line"># 指定日志文件夹，如果使用了logback可以指定自己的日志文件夹路径，我用了 logback，所有这个日志文件夹没是没用，但是在启动logback 之前还是会输出一点日志，所有也需要指定一下，我是放在 /tmp 目录下</span><br><span class="line">LOG_FOLDER=/tmp</span><br><span class="line"># 指定spring boot 的参数</span><br><span class="line">RUN_ARGS=&quot;--logging.config=/home/conf/logback-spring.xml --spring.profiles.active=test&quot;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>不使用 systemd 而使用脚本启动和关闭.<br>该方式同样支持冲注册中心销毁并且调用生命周期事件。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">APP_NAME=$2</span><br><span class="line">#使用说明，用来提示输入参数</span><br><span class="line">usage() &#123;</span><br><span class="line">    echo &quot;Usage: sh 执行脚本.sh [start|stop|restart|status]&quot;</span><br><span class="line">    exit 1</span><br><span class="line">&#125;</span><br><span class="line">#拼接可执行 jar 的路径</span><br><span class="line">jar_path()&#123;</span><br><span class="line">    SHELL_FOLDER=$(cd &quot;$(dirname &quot;$0&quot;)&quot;;pwd)</span><br><span class="line">    JAR_PATH=&quot;$SHELL_FOLDER/../applications/$APP_NAME.jar&quot;</span><br><span class="line">    return $JAR_PATH</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#启动方法</span><br><span class="line">start()&#123;</span><br><span class="line">  /bin/bash `jar_path` start</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#停止方法</span><br><span class="line">stop()&#123;</span><br><span class="line">  /bin/bash `jar_path` stop</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#输出运行状态</span><br><span class="line">status()&#123;</span><br><span class="line">  /bin/bash `jar_path` status</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#重启</span><br><span class="line">restart()&#123;</span><br><span class="line">  /bin/bash `jar_path` restart </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#根据输入参数，选择执行对应方法，不输入则执行使用说明</span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">  &quot;start&quot;)</span><br><span class="line">    start</span><br><span class="line">    ;;</span><br><span class="line">  &quot;stop&quot;)</span><br><span class="line">    stop</span><br><span class="line">    ;;</span><br><span class="line">  &quot;status&quot;)</span><br><span class="line">    status</span><br><span class="line">    ;;</span><br><span class="line">  &quot;restart&quot;)</span><br><span class="line">    restart</span><br><span class="line">    ;;</span><br><span class="line">  *)</span><br><span class="line">    usage</span><br><span class="line">    ;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>



















</li>
</ol>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <!--
<div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">陈先森</p>
  <div class="site-description" itemprop="description"></div>
</div>
-->
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">24</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">陈先森</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  
















  

  


</body>
</html>
